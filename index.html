<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AI SIP Flow Analyzer</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        textarea { width: 100%; height: 200px; margin-bottom: 10px; }
        #diagram { margin-top: 20px; border: 1px solid #ddd; padding: 10px; }
    </style>
</head>
<body>
    <h1>SIP Log AI 시각화 도구</h1>
    <textarea id="logInput" placeholder="여기에 CALL 로그를 붙여넣으세요..."></textarea>
    <button id="btnAnalyze">Flow 생성 및 분석</button>
    
    <div id="diagram"></div>

    <script>
        mermaid.initialize({ startOnLoad: false, theme: 'default' });

        document.getElementById('btnAnalyze').onclick = async () => {
            const log = document.getElementById('logInput').value;
            const diagDiv = document.getElementById('diagram');
            diagDiv.innerHTML = "AI 분석 중...";

            const res = await fetch('/api/analyze', {
                method: 'POST',
                body: JSON.stringify({ log }),
                headers: { 'Content-Type': 'application/json' }
            });

            const data = await res.json();
            // Gemini 응답에서 Mermaid 코드만 추출 (백틱 제거 등)
            const code = data.mermaidCode.replace(/```mermaid|```/g, "").trim();
            
            diagDiv.innerHTML = `<pre class="mermaid">${code}</pre>`;
            await mermaid.run();
        };
    </script>
</body>
</html>
